# ТЗ: фронт, API, Swagger, медиа и срезы по моделям

Краткая сводка для фронта и бэкенда: что есть, что нужно доработать.

---

## 1. Картинки по сокетам (уже есть)

**WebSocket:** `ws://<host>:8010/ws/render/{modelId}`

- **Клиент шлёт** (JSON): `{ "type": "rotate", "azimuth": 345.5, "elevation": 6.8, "final": false }`
- **Сервер шлёт** в ответ: бинарное сообщение — **JPEG** кадр рендера под эти углы.

Фронту нужно: подключаться к сокету по `modelId` (s3ObjectKey), при смене углов слать `rotate`, принимать `BinaryMessage` и отображать как изображение (например, в `<img>` через blob URL или canvas). Так картинки и передаются по сокетам без отдельного REST для каждого кадра.

---

## 2. Swagger

- **Подключён:** springdoc-openapi (starter-webmvc-ui).
- **UI:** после запуска приложения — `http://<host>:8010/swagger-ui.html` или `http://<host>:8010/swagger-ui/index.html`.

**Уже в Swagger:**
- `GET /files` — список моделей
- `GET /files/{objectKey}` — инфо по модели
- `POST /files/upload` — загрузка модели (multipart)
- `DELETE /files/{objectKey}` — удаление модели
- `GET /files/{objectKey}/render?azimuth=&elevation=` — один кадр рендера (REST, для превью; основной поток — по WebSocket).

Дальше: добавить в Swagger описание эндпоинтов для **описания модели**, **фото/видео** и **срезов** (когда они появятся в API).

---

## 3. Модели: просмотр, добавление, удаление

| Действие        | Как сейчас |
|-----------------|------------|
| Просмотр всех   | `GET /files` |
| Добавить модель | `POST /files/upload` (multipart, поле с OBJ) |
| Удалить модель  | `DELETE /files/{objectKey}` |
| Просмотр одной  | `GET /files/{objectKey}` + WebSocket для рендера |

Кодирование ключа в URL: `encodeURIComponent(objectKey)`.

---

## 4. Описание, фото и видео к каждой модели

**Сейчас в БД (FileAttributes):** уже есть поле `description`.

**Нужно доработать (бэкенд):**
- Хранить к модели:
  - **описание** — уже есть, нужно прокинуть в API (GET/PATCH для метаданных модели).
  - **фото** — список файлов или URL (хранить в MinIO, ссылки/ключи в БД).
  - **видео** — аналогично (файлы в MinIO, метаданные в БД).

Идея API для фронта:
- `GET /files/{objectKey}/meta` — описание, фото, видео (и при необходимости срезы).
- `PATCH /files/{objectKey}/meta` или `PUT /files/{objectKey}/meta` — обновить описание, привязать фото/видео (например, по id или ключам в MinIO).

Конкретную схему (поля, вложенные объекты) лучше зафиксировать в OpenAPI и в этой же доке после согласования.

---

## 5. Срезы по каждой модели

**Требование:** к каждой модели нужно иметь возможность смотреть срезы (слайсы).

**Что нужно определить:**
- Срезы — это пререндеренные изображения (например, по осям X/Y/Z с шагом) или генерируются на лету при запросе (угол, позиция)?
- Хранение: MinIO (готовые картинки) или расчёт на бэкенде по OBJ при запросе?

**Варианты API для фронта:**
- Вариант A: `GET /files/{objectKey}/slices?axis=x|y|z&index=0..N` — отдать изображение среза (если рендер на лету).
- Вариант B: `GET /files/{objectKey}/slices` — список срезов (метаданные + URL или ключи MinIO), фронт качает/показывает картинки.

После выбора варианта — описать в Swagger и в этом ТЗ.

---

## 6. Красивый код и Swagger

- **Код:** общие правила — один стиль (Java), разделение Controller / Service / DTO, аннотации Swagger у всех публичных эндпоинтов.
- **Swagger:**  
  - Группы тегов по смыслу (например: «Модели», «Метаданные и медиа», «Срезы»).  
  - У каждого эндпоинта: краткое описание, параметры, коды ответов, примеры при необходимости.  
  - Описание моделей (схем) для запросов/ответов (описание, фото, видео, срезы).

После добавления новых API — обновлять OpenAPI и эту документацию.

---

## 7. Итог для фронта (кратко)

1. **Картинки по сокетам** — использовать существующий WebSocket `ws://<host>:8010/ws/render/{modelId}`: слать `rotate`, показывать приходящие JPEG.
2. **Swagger** — открыть `http://<host>:8010/swagger-ui.html`, оттуда смотреть и тестировать: список моделей, загрузка, удаление, инфо, рендер.
3. **Модели** — список и CRUD через текущие эндпоинты; описание/фото/видео и срезы — ждать соответствующие эндпоинты (и описание в этом ТЗ / OpenAPI), затем интегрировать.
4. **Красивый код и Swagger** — следовать описанным правилам; после появления новых API описать их в Swagger и в `docs/TZ_FRONT_AND_API.md`.

Если нужно, могу следующим шагом предложить конкретные схемы DTO и пути эндпоинтов для описания, фото, видео и срезов под твой стек (Spring + MinIO + БД).
